<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPS</title>
</head>

<body>
    <script>
        function getComputerChoice (){
            let randNum = Math.floor((Math.random() * 3));
            let compChoice;

            switch (randNum){
                case 0:
                    compChoice = "rock";
                    break;

                case 1:
                    compChoice = "paper";
                    break;

                case 2:
                    compChoice = "scissors";
                    break;
            }

            return compChoice;
        }

        function validInput(input){
            return input === "rock" || input === "paper" || input === "scissors";
        }

        function getUserMove(){
            let stopPrompting = false;
            let userInput;
            do{
                userInput = prompt("What is your move?")
                if (userInput === null){
                    return -1; //"cancel" was pressed
                }
                userInput = userInput.toLowerCase();
                stopPrompting = validInput(userInput);

                if(!stopPrompting) alert("Wrong input");
            }while (!stopPrompting);

            return userInput;
        }

        function outputFinalResult(computerWins, playerWins){
            if(playerWins == computerWins){
                console.log(`Humans and computers are equals`);
            }
            else{
                if(playerWins > computerWins){
                    console.log(`Humanity wins ${playerWins}:${computerWins}!`);
                }
                else if(playerWins < computerWins){
                    console.log(`Humanity lost ${computerWins}:${playerWins}.`);
                }
                if(5 - computerWins - playerWins > 0){
                    let numOfTies = 5 - computerWins - playerWins;
                    console.log(`There were ${numOfTies} ties`);
                }
            }
        }

        function game (){
            let playerWins = 0;
            let computerWins = 0;

            for(let i = 0; i < 5; i++){
                let userMove = getUserMove();
                if(userMove === -1) return;

                let resultText = playRound(userMove, getComputerChoice());
                console.log(resultText);
            }

            outputFinalResult(computerWins, playerWins);

            function playRound (playerSelection, computerSelection){
                let playerWon;

                if(playerSelection === "rock"){
                    if(computerSelection === "scissors") playerWon = true;
                    if(computerSelection === "paper") playerWon = false;
                } 
                else if (playerSelection === "paper"){
                    if(computerSelection === "rock") playerWon = true;
                    if(computerSelection === "scissors") playerWon = false;
                }
                else {
                    if(computerSelection === "paper") playerWon = true;
                    if(computerSelection === "rock") playerWon = false;
                }

                computerSelection = computerSelection.charAt(0).toUpperCase() + computerSelection.slice(1);
                playerSelection = playerSelection.charAt(0).toUpperCase() + playerSelection.slice(1);


                if(playerWon === false){
                    computerWins++;
                    resultText = `You Lose! ${computerSelection} beats ${playerSelection}`;
                }
                else if (playerWon === true){
                    playerWins++;
                    resultText = `You Win! ${playerSelection} beats ${computerSelection}`;
                }
                else{
                    resultText = `It's a Tie!`;
                }

                return resultText;
            }
        }

        game();
    </script>
</body>
</html>